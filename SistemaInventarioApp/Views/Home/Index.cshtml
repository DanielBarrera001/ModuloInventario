@using SistemaInventarioApp.Entidades
@model SistemaInventarioApp.Controllers.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="container py-5">
    <h1 class="mb-4 text-primary">Panel de Control</h1>

    <!-- Tarjetas resumen -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card text-white bg-info shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Total de Productos</h5>
                    <p class="card-text fs-3">@Model.TotalProductos</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card text-white bg-success shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Valor Total Inventario</h5>
                    <p class="card-text fs-3">$@Model.ValorTotalInventario.ToString("N2")</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Últimos Productos -->
        <div class="col-md-6">
            <div class="card shadow-sm border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Últimos Productos Ingresados</h5>
                </div>
                <div class="card-body">
                    @if (Model.UltimosProductos.Any())
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var producto in Model.UltimosProductos)
                            {
                                <li class="list-group-item">
                                    <div><strong>ID:</strong> @producto.Id</div>
                                    <div><strong>Nombre:</strong> @producto.Nombre</div>
                                    <div><strong>Código:</strong> @producto.CodigoBarras</div>
                                    <div><strong>Stock:</strong> @producto.Stock</div>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted">No hay productos registrados aún.</p>
                    }
                </div>
            </div>
        </div>

        <!-- Productos con Stock Bajo -->
        <div class="col-md-6">
            <div class="card shadow-sm border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Productos con Stock Bajo (&lt;15)</h5>
                </div>
                <div class="card-body">
                    @if (Model.ProductosStockBajo.Any())
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var producto in Model.ProductosStockBajo)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>@producto.Nombre</strong><br />
                                        <small>Código: @producto.CodigoBarras</small>
                                    </div>
                                    <span class="badge bg-danger rounded-pill">@producto.Stock</span>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted">No hay productos con stock bajo.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Últimos Movimientos -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Últimos 10 Movimientos</h5>
                </div>
                <div class="card-body">
                    @if (Model.UltimosMovimientos.Any())
                    {
                        <table class="table table-striped table-bordered mb-0">
                            <thead class="table-secondary">
                                <tr>
                                    <th>Producto</th>
                                    <th>Código</th>
                                    <th>Cantidad</th>
                                    <th>Tipo</th>
                                    <th>Fecha/Hora</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var m in Model.UltimosMovimientos)
                                {
                                    var tipoTexto = m.Tipo switch
                                    {
                                        TipoMovimiento.NuevoProducto => "Nuevo Producto",
                                        TipoMovimiento.Ingreso => "Ingreso",
                                        TipoMovimiento.Salida => "Salida",
                                        _ => m.Tipo.ToString()
                                    };
                                    <tr>
                                        <td>@m.Producto.Nombre</td>
                                        <td>@m.Producto.CodigoBarras</td>
                                        <td>@m.Cantidad</td>
                                        <td>@tipoTexto</td>
                                        <td>@m.Fecha.ToString("yyyy-MM-dd HH:mm:ss")</td>
                                    </tr>
                                }

                            </tbody>
                        </table>
                    }
                    else
                    {
                        <p class="text-muted">No hay movimientos recientes.</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
