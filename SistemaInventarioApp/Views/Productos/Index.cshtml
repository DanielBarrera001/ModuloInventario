@model IEnumerable<SistemaInventarioApp.Entidades.Producto>
@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager
@inject SignInManager<IdentityUser> SignInManager
@using SistemaInventarioApp.Servicios

@if (TempData["ErrorEliminar"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show mt-3" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        @TempData["ErrorEliminar"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">Lista de Productos</h2>
        <a class="btn btn-primary shadow-sm" asp-action="Create">
            <i class="bi bi-plus-circle me-1"></i> Agregar Nuevo Producto
        </a>
    </div>

    <div class="card shadow-sm mb-4 p-3">
        <form method="get" asp-action="Index" class="row g-2 align-items-center">
            <div class="col-md-6">
                <input type="text" name="search" class="form-control"
                       placeholder="Buscar por nombre o código"
                       value="@Context.Request.Query["search"]" />
            </div>
            <div class="col-auto">
                <button type="submit" class="btn btn-info shadow-sm">
                    <i class="bi bi-search"></i> Buscar
                </button>
                <a asp-action="Index" class="btn btn-secondary shadow-sm">
                    <i class="bi bi-x-circle"></i> Limpiar
                </a>
            </div>
        </form>
    </div>

    <div class="table-responsive">
        <table class="table table-hover table-bordered align-middle shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>Código de Barras</th>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Precio</th>
                    <th>Stock</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.CodigoBarras</td>
                        <td>@item.Nombre</td>
                        <td>@item.Descripcion</td>
                        <td>@string.Format("{0:C}", item.Precio)</td>
                        <td>
                            <span class="badge @(item.Stock > 10 ? "bg-success" : item.Stock > 0 ? "bg-warning" : "bg-danger")">
                                @item.Stock
                            </span>
                        </td>
                        <td>
                            @{
                                var esAdmin = User.IsInRole(Constantes.RolAdmin);
                            }
                            @if (esAdmin)
                            {
                                <a class="btn btn-warning btn-sm me-1" asp-action="Edit" asp-route-id="@item.Id">
                                    <i class="bi bi-pencil-square"></i> Editar
                                </a>
                                <a class="btn btn-danger btn-sm" asp-action="Delete" asp-route-id="@item.Id">
                                    <i class="bi bi-trash"></i> Eliminar
                                </a>
                            }
                            else
                            {
                                <button class="btn btn-warning btn-sm me-1" disabled title="Necesitas ser admin para editar">
                                    <i class="bi bi-pencil-square"></i> Editar
                                </button>
                                <button class="btn btn-danger btn-sm" disabled title="Necesitas ser admin para eliminar">
                                    <i class="bi bi-trash"></i> Eliminar
                                </button>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
